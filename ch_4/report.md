# Документация проекта

## Описание структуры проекта

Проект состоит из двух основных компонентов:

### Backend (FastAPI)
Обрабатывает запросы от пользователя, обучает модели, делает прогнозы и управляет состоянием моделей.

#### Основные файлы:
- **main.py** — файл с реализацией API, где определены маршруты для обучения моделей, получения прогнозов и работы с моделями.
- **requirements.txt** — файл с зависимостями для backend-сервиса (FastAPI, scikit-learn, pandas, numpy и другие).
- **models/** — директория для хранения обученных моделей.
- **logs/** — директория для хранения логов.
- **Dockerfile** — файл для создания контейнера для backend-сервиса.

### Frontend (Streamlit)
Приложение на базе Streamlit для взаимодействия с пользователем. Позволяет загружать данные, обучать модели, выводить результаты и сравнивать прогнозы.

#### Основные файлы:
- **app.py** — основной файл с реализацией интерфейса Streamlit.
- **requirements.txt** — файл с зависимостями для frontend-сервиса (Streamlit, Plotly, requests и другие).
- **logs/** — директория для хранения логов.
- **Dockerfile** — файл для создания контейнера для frontend-сервиса.

### Общие компоненты:
- **docker-compose.yml** — конфигурация для запуска всех сервисов через Docker Compose (backend, frontend, elasticsearch, kibana и filebeat).
- **filebeat** — для отправки логов в Elasticsearch.
- **elasticsearch** и **kibana** — для хранения и визуализации логов.

---

## Описание функционала API (Backend)

### Маршруты:

- **POST /fit** — Запускает обучение модели для заданного тикера с указанными параметрами (размер окна и количество дней для прогноза). Обучение выполняется в фоновом режиме.

  **Параметры**:
  - `ticker`: тикер актива (например, "SBER").
  - `params`: параметры модели для обучения (размер окна и количество дней для прогноза).

- **GET /predict** — Возвращает прогноз для активной модели.

  **Ответ**:
  - Прогнозируемые цены.
  - Метрики модели (MSE, RMSE, R²).

- **GET /models** — Возвращает список всех обученных моделей.

  **Ответ**:
  - Список моделей с метками их метрик (например, MSE, RMSE).

- **POST /set** — Устанавливает активную модель для прогнозирования.

  **Параметры**:
  - `ticker`: тикер актива, для которого нужно установить модель.

- **POST /retrain** — Перетренирует модель для заданного тикера с новыми данными.

  **Параметры**:
  - `ticker`: тикер модели.
  - `params`: параметры модели (размер окна и количество дней для прогноза).

- **GET /compare_models** — Сравнивает несколько моделей по прогнозам для заданных тикеров.

  **Параметры**:
  - `tickers`: список тикеров для сравнения.

  **Ответ**:
  - Прогнозы для каждого тикера, для которого есть обученная модель.

### Процесс обучения модели:
1. Модель обучается с использованием данных о ценах акций с заданным размером окна (например, 10 дней).
2. Прогнозируется цена на несколько дней вперед.
3. Метрики (MSE, RMSE, R²) сохраняются и возвращаются в ответе API.

---

## Описание функционала Streamlit-приложения (Frontend)

### Основные возможности:

- **Загрузка данных**: Пользователь может загрузить CSV-файл с данными о ценах акций для обучения модели.
  - В интерфейсе отображается таблица с данными.

- **Обучение модели**: Для выбранного тикера, с заданным размером окна и количеством дней для прогноза, пользователь может обучить модель с помощью кнопки "Обучить модель".

- **Информация о модели**: После обучения или загрузки модели пользователь может просматривать информацию о модели, включая метрики (MSE, RMSE, R²) и график прогнозируемых цен.

- **Сравнение моделей**: Пользователь может выбрать несколько тикеров и сравнить прогнозы моделей для разных активов на одном графике.

- **Настройка активной модели**: Пользователь может выбрать активную модель для прогнозирования, которая будет использоваться для вывода прогноза.

---

## Инструкция по использованию

### Запуск проекта с Docker:

1. Клонируйте репозиторий.
2. Перейдите в директорию проекта и запустите следующие команды:
    ```bash
    docker-compose up --build
    ```

### Использование API:

1. Запустите backend-сервис, доступный по адресу `http://localhost:8000`.
2. API предоставляет несколько маршрутов для работы с моделями (описаны выше).

### Использование Streamlit-приложения:

1. Откройте frontend-приложение по адресу `http://localhost:8502`.
2. Загрузите данные о ценах акций, обучите модель и получите прогнозы.

## Скриншоты Работы Сервиса

https://github.com/klassnenkiy/stock_price_prediction/tree/dev/ch_4/img
