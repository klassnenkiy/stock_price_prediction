- [Эксперементы](https://github.com/klassnenkiy/stock_price_prediction/blob/main/ch_3/Experiments_ch3.ipynb)
- [Пайплайн обучения и лучшая из моделей](https://github.com/klassnenkiy/stock_price_prediction/blob/main/ch_3/Baseline_ch3.ipynb)


# Описание построения бейзлайна

Бейзлайн модель, выбранное после проведенных эксперементов, представляет собой **линейную регрессию**, которая пытается предсказать цену закрытия акции на основе исторических данных. Так как именно она показала пока что наилучшие результаты)). Модель использует метод скользящего окна (window-based approach), где для предсказания текущей цены использовались данные о ценах закрытия за предыдущие несколько дней.

### Процесс построения модели:
1. **Данные**: Модель использует исторические данные по цене закрытия акций для нескольких тикеров, а также даты торговли для каждого дня.
2. **Предобработка данных**: 
   - Тикеры, не входящие в список `first_tier_tickers`, фильтруются.
   - Индексы столбца `TRADEDATE` конвертируются в формат `datetime`.
3. **Скользящее окно (windowing)**: Для каждого тикера создаются окна с историей цен закрытия размером в 10 дней. Эти окна используются как входные данные для модели, а следующая цена закрытия (через 10 дней) — как целевая переменная.
4. **Моделирование**: Применяется линейная регрессия для прогнозирования следующей цены закрытия на основе предыдущих 10 дней.
5. **Прогнозирование**: После того как модель обучена на тренировочных данных, она предсказывает будущее поведение цены (на 30 дней вперед), используя последние 10 значений.

# Мотивация выбора метрик

Для оценки качества модели были выбраны следующие метрики:

### 1. **MSE (Mean Squared Error)**:
   - Это среднеквадратичная ошибка, которая измеряет средний квадрат разности между предсказанными и фактическими значениями. Это метрика, которая сильно чувствительна к большим ошибкам, так как они возводятся в квадрат. MSE дает хорошее представление о том, насколько хорошо модель прогнозирует данные.
   - **Мотивация**: MSE полезен для выявления крупных ошибок в модели, и его минимизация помогает уменьшить эффект ошибок, возникающих в дальнем прогнозировании.

### 2. **MAE (Mean Absolute Error)**:
   - Средняя абсолютная ошибка измеряет среднее отклонение прогнозируемых значений от фактических. В отличие от MSE, MAE менее чувствителен к выбросам и дает более "практичное" понимание средней величины ошибки.
   - **Мотивация**: MAE более интерпретируемая метрика, особенно если нужно узнать, в среднем, насколько сильно предсказания отклоняются от реальных значений. Это полезно, когда важна точность в "повседневных" прогнозах, а не в случайных крупных отклонениях.

### 3. **RMSE (Root Mean Squared Error)**:
   - Это корень из MSE, который возвращает ошибку в той же единице измерения, что и исходные данные (в данном случае — цена закрытия). RMSE полезен для того, чтобы увидеть, как сильно модель ошибается в среднем.
   - **Мотивация**: RMSE полезен, так как возвращает ошибку в тех же единицах, что и данные, что позволяет лучше понимать масштаб ошибок в предсказаниях.

### 4. **MAPE (Mean Absolute Percentage Error)**:
   - Это средняя абсолютная процентная ошибка, которая измеряет отклонения предсказанных значений от фактических в процентах. Это полезно для того, чтобы понять, насколько сильно модель ошибается в процентах относительно фактических данных.
   - **Мотивация**: MAPE является полезной метрикой, когда необходимо измерить ошибку в процентах и делать выводы, насколько модель хороша в процентах от ожидаемой цены.

### 5. **R² (R-squared)**:
   - Это коэффициент детерминации, который измеряет, насколько хорошо модель объясняет дисперсию данных. Значение R² варьируется от 0 до 1, где 1 означает, что модель идеально объясняет данные, а 0 — что модель не объясняет ничего из наблюдаемых изменений.
   - **Мотивация**: R² предоставляет хорошее представление о том, насколько хорошо линейная модель справляется с предсказанием цены закрытия, и насколько хорошо она объясняет вариации в данных.

# Анализ результатов

- **SBER, SBERP, ROSN, SIBN** и другие тикеры показывают разные результаты на этих метриках. Важно обратить внимание на следующие моменты:
  
  1. **Высокие значения R²** для многих тикеров (например, **SBERP (0.693)**, **ROSN (0.841)**, **SIBN (0.893)**) указывают на то, что модель объясняет значительную часть изменений в цене, что является положительным результатом.
  
  2. **Высокие значения MSE и RMSE** для некоторых тикеров (например, **LKOH (10477.18)** и **PLZL (66388.1)**) свидетельствуют о том, что предсказания модели могут быть очень неточными в определенные моменты, что также указывает на возможность присутствия выбросов или нестабильности на рынке для этих тикеров.

  3. **Очень низкий MAPE** (например, **SNGS (0.02%)**) и **MAE** для некоторых тикеров показывают, что модель очень точно предсказывает эти акции, что указывает на потенциальную стабильность или меньшую волатильность этих активов.

  4. **Ошибка прогноза на будущее**: Несмотря на наличие хороших результатов на обучающих данных, важно помнить, что прогнозирование на 30 дней вперед часто сопряжено с повышенной неопределенностью. Поэтому важно всегда учитывать риски, особенно для нестабильных рынков или в условиях резких изменений цен.

# Заключение

Модель линейной регрессии дала полезные результаты для ряда тикеров, но имеет свои ограничения в плане прогноза на будущее, особенно для тикеров с высокой волатильностью. Выбор метрик оказался обоснованным, так как они дают всестороннюю картину качества модели, включая как точность, так и способность модели объяснять вариацию в данных.

__________________________________________________________________________________________________________________________________________________________________


#  Результаты других эксперементов и моделей на первичных данных

## 1. **Сезонная наивная модель**
Модель дает плохие результаты для большинства акций. Например, SBER имеет очень низкие значения R² (-0.90), что свидетельствует о том, что модель не объясняет большую часть вариации данных.  
Для некоторых акций, таких как LKOH, MSE и RMSE очень высоки, что указывает на сильное расхождение между предсказаниями и реальными значениями.  
Однако для SNGS модель работает относительно лучше с MSE = 1.97 и R² = -0.67, но все равно далеко от идеальных значений.

## 2. **Модель Холта-Винтерса**
Модель также показывает слабые результаты для большинства акций, например, LKOH с MSE = 909465 и R² = -10.54 указывает на огромные ошибки прогнозирования.  
Некоторые другие акции, такие как SNGS, показывают лучшие результаты (MSE = 1.91 и R² = -0.63), но это все равно далеко от идеальных значений.

## 3. **Линейная регрессия**
Линейная регрессия показывает значительно лучшие результаты по сравнению с предыдущими моделями. Например, SBER имеет R² = 0.69, что свидетельствует о хорошем объяснении вариации данных.  
Особенно хорошо работает модель для ROSN и SIBN, с очень высокими значениями R² (0.84 и 0.89 соответственно), что означает, что линейная регрессия объясняет большую часть их колебаний.

## 4. **Модель SARIMAX**
Модель SARIMAX демонстрирует плохие результаты для большинства акций, особенно для таких как GMKN, с R² = -118834, что явно указывает на неадекватность модели для этой акции.  
Для ROSN и SIBN результаты несколько лучше, но R² все равно остается отрицательным, что также говорит о недостаточности модели.

## 5. **Модель Prophet**
Модель Prophet показывает некоторые улучшения по сравнению с предыдущими моделями, но все равно результаты для большинства акций остаются слабыми. Например, для SBER и SBERP R² равны примерно -3.2 и -3.0, что означает, что модель не объясняет колебания цен акций.  
Для SNGS результаты хорошие с MSE = 2.55, но все равно наблюдаются отрицательные значения R².

## 6. **Модель LSTM**
Модель LSTM показывает лучшие результаты по сравнению с большинством моделей. Например, для SBER и SBERP значения MSE составляют 57.78 и 65.28, а R² -0.003 и -0.136 соответственно, что также указывает на не совсем точные прогнозы, но она лучше, чем наивные и модели Холта-Винтерса.  
Для ROSN модель имеет R² = 0.39, что довольно неплохо для временных рядов.

---

# Общие выводы эксперементов и выбор модели бейзлайна

- **Линейная регрессия** и **LSTM** показывают наилучшие результаты среди всех моделей, особенно для акций типа **SBER**, **ROSN**, **SIBN** и **LKOH**.  
- **SARIMAX** и **Prophet** имеют значительные трудности с точностью прогнозов, особенно для акций с сильными колебаниями.  
- **Seasonal Naive** и **Holt-Winters** показывают самые слабые результаты, особенно для акций с большими изменениями, таких как **LKOH** и **GMKN**.  
- Таким образом, для большинства акций **линейная регрессия** и **LSTM** являются более подходящими моделями, чем наивные подходы и методы, не учитывающие более сложные зависимости.
